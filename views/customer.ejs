<!DOCTYPE html>
<html lang="en">
<head>
    <!-- ... existing styles ... -->
    <style>
        /* Add these new styles */
        .order-form {
            max-width: 500px;
            margin: 20px auto;
            padding: 20px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
        }
        .form-group input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h2>Place Your Order</h2>

    <div class="order-form">
        <div class="form-group">
            <label for="customerName">Your Name:</label>
            <input type="text" id="customerName" required>
        </div>
        <div class="form-group">
            <label for="customerPhone">Phone Number:</label>
            <input type="tel" id="customerPhone" required>
        </div>
    </div>

    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Item</th>
                    <th>Price</th>
                    <th>Quantity</th>
                    <th>Total</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                <% items.forEach(item => { %>
                <tr>
                    <td><%= item.name %></td>
                    <td>$<%= item.price %></td>
                    <td>
                        <input type="number" class="quantity-input" 
                               data-price="<%= item.price %>" 
                               data-item="<%= item.name %>" 
                               value="0" min="0">
                    </td>
                    <td class="item-total">$0</td>
                    <td>
                        <button onclick="addToOrder(this)" class="add-btn">Add</button>
                    </td>
                </tr>
                <% }) %>
            </tbody>
        </table>
    </div>

    <div class="total">Total: $<span id="orderTotal">0</span></div>
    
    <div class="button-group">
        <button onclick="submitOrder()">Submit Order</button>
        <button onclick="resetOrder()">Reset</button>
    </div>

    <script>
        let orderItems = [];
        let total = 0;

        function addToOrder(btn) {
            const row = btn.closest('tr');
            const quantity = parseInt(row.querySelector('.quantity-input').value);
            if (quantity <= 0) return;

            const itemName = row.querySelector('.quantity-input').dataset.item;
            const price = parseFloat(row.querySelector('.quantity-input').dataset.price);
            const itemTotal = quantity * price;

            // Update or add item
            const existingItem = orderItems.find(item => item.name === itemName);
            if (existingItem) {
                existingItem.quantity = quantity;
            } else {
                orderItems.push({ name: itemName, price, quantity });
            }

            // Update totals
            updateTotals();
        }

        function updateTotals() {
            total = orderItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            document.getElementById('orderTotal').textContent = total.toFixed(2);

            // Update individual item totals
            document.querySelectorAll('.quantity-input').forEach(input => {
                const row = input.closest('tr');
                const quantity = parseInt(input.value);
                const price = parseFloat(input.dataset.price);
                row.querySelector('.item-total').textContent = `$${(quantity * price).toFixed(2)}`;
            });
        }

        function resetOrder() {
            orderItems = [];
            total = 0;
            document.querySelectorAll('.quantity-input').forEach(input => {
                input.value = 0;
            });
            updateTotals();
        }

        function submitOrder() {
            const customerName = document.getElementById('customerName').value;
            const customerPhone = document.getElementById('customerPhone').value;

            if (!customerName || !customerPhone) {
                alert('Please enter your name and phone number');
                return;
            }

            if (orderItems.length === 0) {
                alert('Please add items to your order');
                return;
            }

            const orderData = {
                customerName,
                customerPhone,
                items: orderItems,
                totalPrice: total
            };

            fetch('/customer/submit-order', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(orderData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Order submitted successfully!');
                    resetOrder();
                } else {
                    alert('Failed to submit order. Please try again.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred. Please try again.');
            });
        }

        // Update totals when quantity changes
        document.querySelectorAll('.quantity-input').forEach(input => {
            input.addEventListener('change', () => {
                const row = input.closest('tr');
                const addBtn = row.querySelector('.add-btn');
                addToOrder(addBtn);
            });
        });
    </script>
</body>
</html>